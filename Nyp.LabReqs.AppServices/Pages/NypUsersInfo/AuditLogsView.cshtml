@page
@model EDocs.Nyp.LabReqs.AppServices.Pages.NypUsersInfo.AuditLogsViewModel
@{
    ViewData["Title"] = "AuditLogsView";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}
<div id="headingSessionExp" style="display:none">
    <h3 class="text-center text-danger border">Your Session will expire in&nbsp;<span id="seconds"></span>&nbsp;seconds.<br /></h3>
</div>
@*
    <partial name="Shared/_RecordsNetImage" />
*@
<div id="divMain" name="divMain">
    <h1 class="text-center">Search AuditLogs</h1>
    <p class="p-1" />


    <div class="container-fluid" style="background-color:azure;">
        <p class="p-2" />
        <a href="#searchOptions" name="sOptions" id="sOptions" class=" btn btn-primary text-center" data-toggle="collapse" onmouseout="document.getElementById('showmess').style.display = 'none'" onmouseover="document.getElementById('showmess').style.display = 'block'">Search Options</a>
        <p class="alert-light" id="showmess" style="display:none">Click to expand/hide Search Options</p>


        <div id="searchOptions" class="collapse">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th class="text-center">Audit Log Begin Date</th>
                        <th class="text-center">Audit Log End Date</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center" data-toggle="mm/dd/yyyy for all dates"><input type="date" id="searchStartDate" name="searchStartDate" value="@Model.StartDate" onmouseout="ShowHideDialog('showmessage')" onmouseover="ShowHideDialog('showmessage')" /><p id="showmessage" style="display:none">mm/dd/yyyy to search all dates all dates</p></td>

                        <td class="text-center"><input type="date" id="searchEndDate" name="searchEndDate" value="@Model.EndDate" /></td>


                    </tr>
                </tbody>

            </table>
            @*
                <div id="checkboxSearchDates" style="display:none">
                    <input type="hidden" id="searchBydate" name="searchBydate" />
                    <div class="row alert-info">
                        <div class="col-2">
                            <p>Search By</p>
                        </div>
                        <div class="col-3">
                            <input type="radio" name="lDate" id="lDate" />&nbsp;Date Of Service

                        </div>
                        <div class="col-2">
                            <input type="radio" id="sDate" name="sDate" value="SDate" />&nbsp;Scan Date
                        </div>
                    </div>
                </div>
            *@
            @if ((@Model.LALogCwid != null) && (@Model.LALogCwid.Count > 0))
            {

                <div class="container-fluid">
                    <form method="get" id="fmAuditLog" class="form-inline justify-content-center">
                        <div class="form-group">

                            <div class="form-row">
                                @Html.LabelFor(model => model.LALogMessageType)&nbsp;&nbsp;
                                @Html.DropDownList("AlErrorType", new SelectList(Model.LALogMessageType.Select(x => x.AuditLogMessageType), Model.LALogMessageType))&nbsp;&nbsp;
                            </div>

                            <div class="form-row">
                                &nbsp;&nbsp;@Html.LabelFor(model => model.LALogAppName)&nbsp;&nbsp;
                                @Html.DropDownList("AlAppName", new SelectList(Model.LALogAppName.Select(x => x.AuditLogApplicationName), Model.LALogAppName)) &nbsp;&nbsp;
                            </div>

                            <div class="form-row">
                                &nbsp;&nbsp;@Html.LabelFor(model => model.LALogCwid)&nbsp;&nbsp;
                                @Html.DropDownList("AlCwid", new SelectList(Model.LALogCwid.Select(x => x.Cwid), Model.LALogCwid)) &nbsp;&nbsp;
                            </div>
                        </div>

                    </form>
                    <p class="p-1"></p>
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col text-center">
                                <button id="btnAdLogs" name="btnAdLogs" type="submit" class="btn btn-outline-info">Search Audit Logs</button>
                                <a href="/Index" target="_self" class="btn   btn-outline-dark" role="button">Exit</a>
                            </div>
                        </div>
                        <p class="p-1"></p>
                    </div>
                </div>
            }
            else
            {
                <div class="container">
                    <p class="text-info text-center">No Audit Logs found</p>
                    <a href="/Index" target="_self" class="btn btn-block btn-outline-dark" role="button">Exit</a>
                </div>
            }


        </div>@*End div search options*@
    </div>@*End div container*@
</div>


@if ((@Model.AuditLogs != null))
{
    <div id="divLabReqs">

        <table class="table table-hover w-auto" width="100%" id="dtLabReqs">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Download CSV File</th>
                    <th>CWID</th>
                    <th>Application Name</th>
                    <th>Message Type</th>
                    <th>Log Date</th>
                    <th>Log Date Uploaded</th>
                    <th>View Audit Log</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var items in Model.AuditLogs)
                {

                    <tr>
                        @*
                            <td> <a href="/Partial_Pages/DisplayPdfFilePartialView?pdfurl=@items.Value.AuditLogUrl" target="_blank"><img src="~/Images/excel.png" width="20" height="25" /></a></td>
                        *@
                        <td>@items.Key</td>
                        <td> <a href="@items.Value.AuditLogUrl" target="_blank"><img src="~/Images/excel.png" width="20" height="20" /></a></td>
                        <td>@items.Value.Cwid</td>
                        <td>@items.Value.AuditLogApplicationName</td>
                        <td>@items.Value.AuditLogMessageType</td>
                        <td>@items.Value.AuditLogDate.ToString("MM-dd-yyyy")</td>
                        <td>@items.Value.AuditLogUpLoadDate</td>
                        <td><a href="/NypUsersInfo/ViewAuditLogsView?ViewAuditLog=@items.Value.AuditLogUrl" target="_blank" role="button" class="btn btn-link">View Audit Log</a></td>
                    </tr>
                }
            </tbody>
        </table>
        <p class="p-0" />
        <p class="text-left">Total Query Time @Model.TotalQueryTime</p>
        <p class="p-0" />
    </div>
}

<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p id="parLoading" style="position: absolute; top: 30%; left: 45%; color: White;">
        Getting data, please wait...<img src="~/Images/ajax-loading.gif">
    </p>
</div>

@section scripts{
    <script>
        $(document).ready(function () {
            SessionExpireAlert(0);
            //$(this).bind("contextmenu", function (e) {

            //    e.preventDefault();

            //});
            $("#searchStartDate").focus();
            $("#divLoading").hide();
            CompleteAjaxCall();


            $('#searchStartDate').change(function () {

                GetSearchStartEndDate();
            });
            $('#searchEndDate').change(function () {
                GetSearchStartEndDate();
            });
            $('#btnAdLogs').click(function () {
                ShowHideDialog('divLoading');
                if ($('#searchStartDate').val() == '') {
                    $("<input type='hidden'/>")
                        .attr("value", '1900/01/01')
                        .attr("id", "startSDate")
                        .attr("name", "startSDate")
                        .prependTo("#fmAuditLog");
                }
                else {
                    $("<input type='hidden'/>")
                        .attr("value", $('#searchStartDate').val())
                        .attr("id", "startSDate")
                        .attr("name", "startSDate")
                        .prependTo("#fmAuditLog");
                    $("<input type='hidden'/>")
                        .attr("value", $('#searchEndDate').val())
                        .attr("id", "endSDate")
                        .attr("name", "endSDate")
                        .prependTo("#fmAuditLog");
                }


                $('#fmAuditLog').submit();
            });
        });
    </script>
}
